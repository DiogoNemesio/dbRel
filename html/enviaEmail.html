<!DOCTYPE html>
<html lang="pt-BR" >
<head>
	%LOAD_HTML%
</head>
<body leftmargin="0" marginheight="0" marginwidth="0" topmargin="0">
<div id="content">
	%LOCALIZACAO%
	<div class="box-header" data-original-title>
    	<h4><i class="icon-edit"></i><span class="break"></span>&nbsp;Envio de E-mails</h4>
	</div>
	<hr>
	<div class="box-content">
	    <form class="form-horizontal navbar-search pull-left" id="zgFormID" action="#">
        <input type="hidden" name="id" value="%ID%">
	    <fieldset>
		    <div class="control-group">
   	    	
		    <div class="control-group">
    			<label class="control-label" for="nomeID">Nome</label>
    			<div class="controls">
    				<div class="input-prepend">
    					<span class="add-on"><i class="icon-book"></i></span>
    					<input class="input-large" id="nomeID" type="text" name="nome" autocomplete="off">
    				</div>
    			</div>
    		</div>
		    <div class="control-group">
    			<label class="control-label" for="cidadeID">UF / Cidade</label>
    			<div class="controls">
    				<div class="input-prepend">
    					<span class="add-on"><i class="icon-home"></i></span>
    					<input type="text" name="cidade" id="cidadeID" data-provide="typeahead" autocomplete="off"/>
    				</div>
    			</div>
    		</div>
    		 <div class="control-group">
				<div class="controls">
					<button type="button" class="btn btn-primary" id="submit">Buscar</button>
				</div>
			</div>
	    </fieldset>
	    </form>
	</div>
</div>
<div id="zgDivModalID" class="modal hide fade"></div>
<div id="zgDivSendMailID" class="modal hide fade"></div>
<script>
var timer;

$('#submit').click(function() {
	mostraPacientes($('#nomeID').val(),$('#cidadeID').val())
});

$("#cidadeID").typeahead({
	minLength: 	%PARAM_BS_TA_MINLENGTH%,
	itens:		%PARAM_BS_TA_ITENS%,
    source : function(query,process) {
    	clearTimeout(timer);
    	timer=setTimeout(function() {
	    	$.ajax({
	            type: "GET",
	    	    url: "%DP_URL%/getCidades.php",
	        	dataType: "json",
				data: { q: query },
	        	async: false,
	        	success: function(data) {
	        		return(process(data));
	            }
	    	})
    	}, %PARAM_BS_TA_TIMEOUT%);
    }
});

$("input,textarea").jqBootstrapValidation({
	preventSubmit: true
});


function mostraPacientes(pNome,pCidade) {
	var url = 'mostraPacientes.php?nome='+pNome+'&cidade='+$.base64.encode(pCidade);
	$('#zgDivModalID').load(url,function(){
	    $(this).modal({
	        keyboard:true,
	        backdrop:true
	    });
	}).css({
	    width: '800px',
	    'margin-left': function () {
	        return -($(this).width() / 2);
	    }
	}).modal('show');
}

</script>

</body>	
</html>